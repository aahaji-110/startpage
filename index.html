<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بوابة أكاديمية الصحة | EMS Academy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-black: #000000; 
            --card-bg: rgba(18, 18, 18, 0.98);
            --text-white: #ffffff;
            --primary-color: #588157; 
        }

        [data-theme="light"] {
            --bg-black: #f0f2f5;
            --card-bg: #ffffff;
            --text-white: #1a1a1a;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-black);
            color: var(--text-white);
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            transition: 0.3s;
            overflow: hidden; 
        }

        /* شريط الترحيب العلوي */
        .welcome-top-bar {
            width: 100%;
            background: var(--primary-color);
            color: white;
            text-align: center;
            padding: 6px 0;
            font-size: 0.9rem;
            font-weight: bold;
            position: fixed;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* قائمة المتصلين الجانبية */
        #onlineList {
            position: fixed; right: 20px; top: 50px; width: 180px;
            background: var(--card-bg); border: 1px solid var(--primary-color);
            border-radius: 12px; padding: 12px; z-index: 100;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .online-header { font-size: 0.8rem; border-bottom: 1px solid rgba(88, 129, 87, 0.3); padding-bottom: 5px; margin-bottom: 10px; color: var(--primary-color); display: flex; justify-content: space-between; font-weight: bold; }
        .trainer-item { display: flex; align-items: center; gap: 8px; font-size: 0.75rem; margin-bottom: 6px; }
        .online-dot { width: 8px; height: 8px; background: #2ecc71; border-radius: 50%; box-shadow: 0 0 5px #2ecc71; }

        /* الحاوية الرئيسية (طولية وكبيرة) */
        .app-container {
            width: 90%;
            max-width: 520px; /* عرض متوازن للطول */
            background: var(--card-bg);
            border: 1px solid rgba(88, 129, 87, 0.3);
            border-radius: 20px;
            padding: 25px 35px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.7);
            position: relative;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
        }

        .top-toolbar { display: flex; justify-content: center; margin-bottom: 15px; }
        .tool-btn {
            background: rgba(88, 129, 87, 0.1); border: 1px solid var(--primary-color);
            color: var(--primary-color); padding: 6px 14px; border-radius: 8px;
            cursor: pointer; font-size: 0.8rem; font-weight: bold; font-family: 'Cairo';
        }

        header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px; 
            border-bottom: 1px solid rgba(88, 129, 87, 0.2); 
            padding-bottom: 15px; 
        }
        .logo-img { height: 85px; filter: drop-shadow(0 0 5px var(--primary-color)); }
        .header-text { text-align: left; }
        .header-text h2 { color: var(--primary-color); margin: 0; font-size: 1.4rem; font-weight: 900; line-height: 1.1; }
        .header-text span { display: block; font-size: 1rem; opacity: 0.9; font-weight: bold; }

        /* شاشة الدخول والبصمة */
        .input-group { position: relative; width: 100%; margin: 10px 0; }
        input {
            width: 100%; padding: 13px; border-radius: 10px; border: 1px solid #333;
            background: rgba(128, 128, 128, 0.05); color: var(--text-white);
            box-sizing: border-box; font-size: 1rem; font-family: 'Cairo';
        }
        .toggle-password { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--primary-color); }

        .action-btn {
            width: 100%; padding: 13px; background: var(--primary-color);
            color: #fff; border: none; border-radius: 10px; font-weight: bold;
            cursor: pointer; margin-top: 10px; font-family: 'Cairo'; font-size: 1rem;
        }

        #fingerprintScanner { text-align: center; padding: 20px; }
        .fingerprint-icon {
            font-size: 5rem; color: var(--primary-color); cursor: pointer;
            transition: 0.3s; animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        /* شبكة الروابط (عمودين) */
        .links-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 12px; 
            margin-top: 10px; 
        }
        .nav-item {
            background: rgba(128, 128, 128, 0.05); border: 1px solid rgba(128, 128, 128, 0.1);
            padding: 15px 10px; border-radius: 12px; color: var(--text-white);
            text-decoration: none; font-size: 0.8rem; font-weight: bold;
            display: flex; flex-direction: column; gap: 8px; align-items: center; transition: 0.2s; text-align: center;
        }
        .nav-item i { font-size: 1.3rem; color: var(--primary-color); }
        .nav-item:hover { transform: translateY(-3px); border-color: var(--primary-color); background: rgba(88, 129, 87, 0.12); }

        .hidden { display: none !important; }
        
        .copyright { text-align: center; margin-top: auto; padding-top: 15px; font-size: 0.7rem; opacity: 0.6; border-top: 1px solid rgba(128,128,128,0.1); }
        .copyright a { color: var(--primary-color); text-decoration: none; font-weight: bold; cursor: pointer; }

        @media (max-width: 800px) { 
            #onlineList { position: static; width: auto; margin: 10px 0; }
            body { overflow-y: auto; height: auto; }
            .app-container { margin: 50px 0; }
        }
    </style>
</head>
<body>

<div class="welcome-top-bar">أهلاً وسهلاً بك في أكاديمية الصحة</div>

<div id="onlineList" class="hidden">
    <div class="online-header"><span>المتصلين الآن</span> <span id="userCount">0</span></div>
    <div id="trainersContainer"></div>
</div>

<div class="app-container">
    <div class="top-toolbar">
        <button class="tool-btn" onclick="toggleTheme()"><i class="fas fa-circle-half-stroke"></i> تبديل المظهر</button>
    </div>

    <header>
        <img src="https://www2.0zz0.com/2025/12/22/17/297618659.png" class="logo-img">
        <div class="header-text">
            <h2>Ministry Of Health</h2>
            <span>EMS Academy</span>
        </div>
    </header>

    <div id="loginScreen">
        <input type="text" id="userInput" placeholder="اسم المستخدم">
        <div class="input-group">
            <input type="password" id="passInput" placeholder="كلمة المرور">
            <i class="fa-solid fa-eye toggle-password" onclick="togglePass()"></i>
        </div>
        <div id="errorMessage" class="hidden" style="color:#ff5252; text-align:center; font-weight:bold; font-size:0.8rem; margin: 5px;">بيانات الدخول غير صحيحة!</div>
        <button class="action-btn" onclick="checkCredentials()">دخول</button>
    </div>

    <div id="fingerprintScanner" class="hidden">
        <p style="font-size: 1.1rem; font-weight: bold; margin-bottom: 15px;">يرجى وضع بصمتك للتحقق</p>
        <i class="fas fa-fingerprint fingerprint-icon" onclick="verifyFingerprint()"></i>
        <p id="scanningMsg" style="font-size: 0.9rem; margin-top: 15px; color: var(--primary-color); min-height: 25px;"></p>
    </div>

    <div id="dashboard" class="hidden">
        <h4 id="welcomeMsg" style="color: var(--primary-color); text-align: center; margin: 0 0 15px 0; font-size: 1rem; font-weight: 900;"></h4>
        <div class="links-grid">
            <a href="https://docs.google.com/spreadsheets/d/1VZDoNKXsIJ1BDPNsg-7KEO35KACeVDF0WjyJR8L9Kxo/edit?gid=1567011153" target="_blank" class="nav-item"><i class="fas fa-file-medical"></i> جدول الصحة</a>
            <a href="https://docs.google.com/spreadsheets/d/1SYGLwafLP1i9mWBiSaLBorEK_i48EMkp4pOj0C_dMU8/edit?usp=sharing" target="_blank" class="nav-item"><i class="fas fa-calendar-alt"></i> جدول الأكاديمية</a>
            <a href="https://aahaji-110.github.io/logs/" target="_blank" class="nav-item"><i class="fas fa-clipboard-list"></i> أعمال الأكاديمية</a>
            <a href="https://aahaji-110.github.io/exam/" target="_blank" class="nav-item"><i class="fas fa-user-md"></i> كتيب المدرب</a>
            <a href="https://forms.gle/n7dYgSPwAfGfKEgH6" target="_blank" class="nav-item"><i class="fas fa-star"></i> نتائج الونقات</a>
            <a href="https://forms.gle/Jh7Z5FTjddWxpHEw9" target="_blank" class="nav-item"><i class="fas fa-file-upload"></i> إرفاق التقارير</a>
            <a href="https://forms.gle/qpxWfgqT6mKoFvmg8" target="_blank" class="nav-item"><i class="fas fa-plane-departure"></i> الإجازة</a>
            <a href="https://forms.gle/twE9sj2dfzqPK9rD7" target="_blank" class="nav-item"><i class="fas fa-user-slash"></i> الاستقالة</a>
            <a href="https://www.canva.com/design/DAGuGH-sDEQ/DLiAkoEAL0MgAarpRTi3vg/view" target="_blank" class="nav-item"><i class="fas fa-gears"></i> آلية التدريب</a>
            <button class="nav-item" style="cursor: pointer; background: none; width: 100%; font-family: 'Cairo';" onclick="document.getElementById('wingsMenu').classList.toggle('hidden')">
                <i class="fas fa-eagle"></i> كتيب الونقات
            </button>
        </div>

        <div id="wingsMenu" class="hidden" style="margin-top: 12px; border-top: 1px solid rgba(88, 129, 87, 0.3); padding-top: 10px;">
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                <a href="https://aahaji-110.github.io/dispatch/" target="_blank" class="nav-item" style="font-size: 0.7rem; padding: 10px;">DC</a>
                <a href="https://aahaji-110.github.io/HC/" target="_blank" class="nav-item" style="font-size: 0.7rem; padding: 10px;">HC</a>
                <a href="https://aahaji-110.github.io/IAC-OAC/" target="_blank" class="nav-item" style="font-size: 0.7rem; padding: 10px;">IAC/OAC</a>
                <a href="https://aahaji-110.github.io/co/" target="_blank" class="nav-item" style="font-size: 0.7rem; padding: 10px;">CO</a>
                <a href="https://aahaji-110.github.io/airship/" target="_blank" class="nav-item" style="font-size: 0.7rem; padding: 10px;">AIR</a>
            </div>
        </div>

        <button class="action-btn" style="background: #333; margin-top: 15px; padding: 10px;" onclick="logout()">خروج من النظام</button>
    </div>

    <div class="copyright">الحقوق محفوظة لـ <a href="mailto:aahaji.110@gmail.com">Discord ali_go</a> &copy; 2026</div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, onDisconnect, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC1C6pC9C_4V8Ya8dM6DlRhQt9LQrd3LMY",
        authDomain: "ems-academy-gate.firebaseapp.com",
        databaseURL: "https://ems-academy-gate-default-rtdb.firebaseio.com",
        projectId: "ems-academy-gate",
        storageBucket: "ems-academy-gate.firebasestorage.app",
        messagingSenderId: "686866880902",
        appId: "1:686866880902:web:d1a239e5776da47604b407"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const DATABASE = [
        { username: "ali_go", password: "qazwsx21", displayName: "FTO Ali" },
        { username: "mohammed", password: "123", displayName: "[Deputy mohammed]" },
        { username: "peka", password: "123", displayName: "FTO Shatha" },
        { username: "halenzi", password: "123", displayName: "FTO Hala Alenzi" },
        { username: "noodi", password: "123", displayName: "Supervisor Noodi" },
        { username: "abdvilah", password: "123", displayName: "FTO AbdvIlah" },
        { username: "abud7im", password: "123", displayName: "FTO ABU D7IM" },
        { username: "rema", password: "123", displayName: "Commander Rema" },
        { username: "wa15", password: "123", displayName: "FTO Waleed" },
        { username: "deema", password: "123", displayName: "EMS CHIEF DEEMA" }
    ];

    let pendingUser = null;

    window.togglePass = function() {
        const p = document.getElementById('passInput');
        p.type = p.type === "password" ? "text" : "password";
    }

    window.toggleTheme = function() {
        const h = document.documentElement;
        h.setAttribute('data-theme', h.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    }

    window.checkCredentials = function() {
        const u = document.getElementById('userInput').value.toLowerCase().trim();
        const p = document.getElementById('passInput').value;
        const user = DATABASE.find(x => x.username.toLowerCase() === u && x.password === p);
        if (user) {
            pendingUser = user;
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('fingerprintScanner').classList.remove('hidden');
        } else {
            document.getElementById('errorMessage').classList.remove('hidden');
        }
    }

    window.verifyFingerprint = function() {
        const msg = document.getElementById('scanningMsg');
        msg.innerText = "جاري قراءة البيانات الحيوية...";
        setTimeout(() => {
            msg.innerText = "تم التحقق! أهلاً بك " + pendingUser.displayName;
            setTimeout(() => {
                localStorage.setItem('ems_logged', 'true');
                localStorage.setItem('ems_name', pendingUser.displayName);
                localStorage.setItem('ems_user', pendingUser.username);
                completeLogin(pendingUser.username, pendingUser.displayName);
            }, 800);
        }, 1200);
    }

    function completeLogin(username, displayName) {
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('fingerprintScanner').classList.add('hidden');
        document.getElementById('dashboard').classList.remove('hidden');
        document.getElementById('onlineList').classList.remove('hidden');
        document.getElementById('welcomeMsg').innerText = "مرحباً بك: " + displayName;
        
        const userRef = ref(db, 'online_trainers/' + username);
        set(userRef, { name: displayName, time: Date.now() });
        onDisconnect(userRef).remove();
        listenOnline();
    }

    function listenOnline() {
        onValue(ref(db, 'online_trainers'), (snapshot) => {
            const container = document.getElementById('trainersContainer');
            container.innerHTML = ""; let count = 0;
            if (snapshot.val()) {
                Object.values(snapshot.val()).forEach(t => {
                    container.innerHTML += `<div class="trainer-item"><div class="online-dot"></div> ${t.name}</div>`;
                    count++;
                });
            }
            document.getElementById('userCount').innerText = count;
        });
    }

    window.logout = function() {
        const username = localStorage.getItem('ems_user');
        if(username) remove(ref(db, 'online_trainers/' + username));
        localStorage.clear();
        location.reload();
    }

    window.onload = function() {
        if (localStorage.getItem('ems_logged') === 'true') {
            completeLogin(localStorage.getItem('ems_user'), localStorage.getItem('ems_name'));
        }
    };
</script>
</body>
</html>

